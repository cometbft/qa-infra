- name: update celestia
  hosts: validators
  become_method: sudo
  gather_facts: yes
  vars:
    tm_home: /root/.celestia-app/
    ansible_host_key_checking: false
 
  tasks:
    - name: pull latest celestia fork
      shell: |
        cd celestia-core
        git pull origin v035-testing
    - name: rebuild celestia
      shell: |
        cd celestia-app 
        PATH=$PATH:/usr/lib/go-1.17/bin make install
    - name: update unit file
      template:
        src: templates/celestiad.service.j2
        dest: /lib/systemd/system/celestiad.service
      become: yes
    - name: restart systemd process
      ansible.builtin.systemd:
        name: celestiad
        state: restarted
        daemon_reload: yes
      become: yes
